{
  "question_name": "find-sum-of-array-product-of-magical-sequences",
  "problem_metadata": {
    "questionId": "3851",
    "title": "Find Sum of Array Product of Magical Sequences",
    "titleSlug": "find-sum-of-array-product-of-magical-sequences",
    "content": "<p>You are given two integers, <code>m</code> and <code>k</code>, and an integer array <code>nums</code>.</p>\nA sequence of integers <code>seq</code> is called <strong>magical</strong> if:\n\n<ul>\n\t<li><code>seq</code> has a size of <code>m</code>.</li>\n\t<li><code>0 &lt;= seq[i] &lt; nums.length</code></li>\n\t<li>The <strong>binary representation</strong> of <code>2<sup>seq[0]</sup> + 2<sup>seq[1]</sup> + ... + 2<sup>seq[m - 1]</sup></code> has <code>k</code> <strong>set bits</strong>.</li>\n</ul>\n\n<p>The <strong>array product</strong> of this sequence is defined as <code>prod(seq) = (nums[seq[0]] * nums[seq[1]] * ... * nums[seq[m - 1]])</code>.</p>\n\n<p>Return the <strong>sum</strong> of the <strong>array products</strong> for all valid <strong>magical</strong> sequences.</p>\n\n<p>Since the answer may be large, return it <strong>modulo</strong> <code>10<sup>9</sup> + 7</code>.</p>\n\n<p>A <strong>set bit</strong> refers to a bit in the binary representation of a number that has a value of 1.</p>\n\n<p>&nbsp;</p>\n<p><strong class=\"example\">Example 1:</strong></p>\n\n<div class=\"example-block\">\n<p><strong>Input:</strong> <span class=\"example-io\">m = 5, k = 5, nums = [1,10,100,10000,1000000]</span></p>\n\n<p><strong>Output:</strong> <span class=\"example-io\">991600007</span></p>\n\n<p><strong>Explanation:</strong></p>\n\n<p>All permutations of <code>[0, 1, 2, 3, 4]</code> are magical sequences, each with an array product of 10<sup>13</sup>.</p>\n</div>\n\n<p><strong class=\"example\">Example 2:</strong></p>\n\n<div class=\"example-block\">\n<p><strong>Input:</strong> <span class=\"example-io\">m = 2, k = 2, nums = [5,4,3,2,1]</span></p>\n\n<p><strong>Output:</strong> <span class=\"example-io\">170</span></p>\n\n<p><strong>Explanation:</strong></p>\n\n<p>The magical sequences are <code>[0, 1]</code>, <code>[0, 2]</code>, <code>[0, 3]</code>, <code>[0, 4]</code>, <code>[1, 0]</code>, <code>[1, 2]</code>, <code>[1, 3]</code>, <code>[1, 4]</code>, <code>[2, 0]</code>, <code>[2, 1]</code>, <code>[2, 3]</code>, <code>[2, 4]</code>, <code>[3, 0]</code>, <code>[3, 1]</code>, <code>[3, 2]</code>, <code>[3, 4]</code>, <code>[4, 0]</code>, <code>[4, 1]</code>, <code>[4, 2]</code>, and <code>[4, 3]</code>.</p>\n</div>\n\n<p><strong class=\"example\">Example 3:</strong></p>\n\n<div class=\"example-block\">\n<p><strong>Input:</strong> <span class=\"example-io\">m = 1, k = 1, nums = [28]</span></p>\n\n<p><strong>Output:</strong> <span class=\"example-io\">28</span></p>\n\n<p><strong>Explanation:</strong></p>\n\n<p>The only magical sequence is <code>[0]</code>.</p>\n</div>\n\n<p>&nbsp;</p>\n<p><strong>Constraints:</strong></p>\n\n<ul>\n\t<li><code>1 &lt;= k &lt;= m &lt;= 30</code></li>\n\t<li><code>1 &lt;= nums.length &lt;= 50</code></li>\n\t<li><code>1 &lt;= nums[i] &lt;= 10<sup>8</sup></code></li>\n</ul>\n",
    "difficulty": "Hard",
    "stats": "{\"totalAccepted\": \"52.2K\", \"totalSubmission\": \"84.2K\", \"totalAcceptedRaw\": 52245, \"totalSubmissionRaw\": 84246, \"acRate\": \"62.0%\"}",
    "topicTags": [
      {
        "name": "Array",
        "slug": "array",
        "translatedName": null
      },
      {
        "name": "Math",
        "slug": "math",
        "translatedName": null
      },
      {
        "name": "Dynamic Programming",
        "slug": "dynamic-programming",
        "translatedName": null
      },
      {
        "name": "Bit Manipulation",
        "slug": "bit-manipulation",
        "translatedName": null
      },
      {
        "name": "Combinatorics",
        "slug": "combinatorics",
        "translatedName": null
      },
      {
        "name": "Bitmask",
        "slug": "bitmask",
        "translatedName": null
      }
    ],
    "hints": [
      "Use Dynamic Programming",
      "Let <code>dp[i][j][mask]</code> be the state after choosing <code>i</code> numbers (indices)",
      "The partial sum <code>S = 2^(seq[0]) + 2^(seq[1]) + ... + 2^(seq[i - 1])</code> has produced exactly <code>j</code> set bits once youâ€™ve fully propagated any carries",
      "The <code>mask</code> represents the \"window\" of lower-order bits from <code>S</code> that have not yet been fully processed (i.e. bits that might later create new set bits when additional terms are added)",
      "Use combinatorics",
      "How many ways are there to permute a sequence of entities where some are repetitive?"
    ]
  },
  "submissions": [
    {
      "id": "1798847259",
      "statusDisplay": "Accepted",
      "lang": {
        "name": "python3",
        "verboseName": "Python3"
      },
      "runtime": 419,
      "memory": 33944000,
      "timestamp": 1760235085,
      "title": "Find Sum of Array Product of Magical Sequences",
      "titleSlug": "find-sum-of-array-product-of-magical-sequences",
      "runtimeDisplay": "419 ms",
      "runtimePercentile": 95.98000000000002,
      "memoryDisplay": "33.9 MB",
      "memoryPercentile": 32.66360000000004,
      "code": "MOD = 10**9 + 7\nfrom functools import lru_cache\nimport math\nfrom typing import List\n\nclass Solution:\n    def magicalSum(self, total_count: int, target_odd: int, numbers: List[int]) -> int:\n        \n        @lru_cache(None)\n        def dfs(remaining, odd_needed, index, carry):\n            if remaining < 0 or odd_needed < 0 or remaining + carry.bit_count() < odd_needed:\n                return 0\n            if remaining == 0:\n                return 1 if odd_needed == carry.bit_count() else 0\n            if index >= len(numbers):\n                return 0\n            \n            ans = 0\n            for take in range(remaining + 1):\n                ways = math.comb(remaining, take) * pow(numbers[index], take, MOD) % MOD\n                new_carry = carry + take\n                ans += ways * dfs(remaining - take, odd_needed - (new_carry % 2), index + 1, new_carry // 2)\n                ans %= MOD\n            return ans\n        \n        return dfs(total_count, target_odd, 0, 0)",
      "statusCode": 10,
      "user": {
        "username": "saachinnnnn",
        "profile": {
          "realName": "Iam4ari"
        }
      },
      "question": {
        "questionId": "3851",
        "titleSlug": "find-sum-of-array-product-of-magical-sequences",
        "hasFrontendPreview": false
      },
      "notes": "",
      "flagType": "WHITE",
      "topicTags": [],
      "runtimeError": null,
      "compileError": null
    }
  ]
}